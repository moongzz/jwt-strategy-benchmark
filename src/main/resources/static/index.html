<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT íš¨ìœ¨ì„± í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            color: #222;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #fafafa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .control-group h3 {
            margin: 0 0 15px 0;
            color: #444;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        input[type="number"], input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        input[type="number"]:focus, input[type="range"]:focus {
            outline: none;
            border-color: #007bff;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #0056b3;
        }

        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: #fafafa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .result-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.4em;
            color: #333;
            text-align: center;
        }

        .whitelist {
            border-left: 4px solid #28a745;
        }

        .blacklist {
            border-left: 4px solid #dc3545;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 10px;
            background: #fff;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .metric-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .chart {
            margin-top: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        canvas {
            width: 100%;
            height: 300px;
        }

        .progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: #28a745;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .results {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ” JWT íš¨ìœ¨ì„± í…ŒìŠ¤íŠ¸</h1>

    <div class="controls">
        <div class="control-group">
            <h3>ğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</h3>
            <div class="input-group">
                <label for="userCount">ì‚¬ìš©ì ìˆ˜</label>
                <input type="number" id="userCount" value="1000" min="100" max="100000">
            </div>
            <div class="input-group">
                <label for="tokenLifetime">í† í° ìˆ˜ëª… (ì´ˆ)</label>
                <input type="number" id="tokenLifetime" value="3600" min="300" max="86400">
            </div>
            <div class="input-group">
                <label for="sessionsPerUser">ì‚¬ìš©ìë‹¹ ì„¸ì…˜ ìˆ˜</label>
                <input type="number" id="sessionsPerUser" value="2" min="1" max="10" step="0.1">
            </div>
        </div>

        <div class="control-group">
            <h3>âš™ï¸ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´</h3>
            <div class="input-group">
                <label for="loginRate">ì‹œê°„ë‹¹ ë¡œê·¸ì¸ ë¹„ìœ¨</label>
                <input type="range" id="loginRate" min="0" max="1" step="0.01" value="0.1">
                <span id="loginRateValue">10%</span>
            </div>
            <div class="input-group">
                <label for="logoutRate">ì‹œê°„ë‹¹ ë¡œê·¸ì•„ì›ƒ ë¹„ìœ¨</label>
                <input type="range" id="logoutRate" min="0" max="1" step="0.01" value="0.05">
                <span id="logoutRateValue">5%</span>
            </div>
        </div>
    </div>

    <div style="text-align: center;">
        <button onclick="runSimulation()">ğŸš€ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
    </div>

    <div class="progress" id="progressContainer" style="display: none;">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="results" id="results" style="display: none;">
        <div class="result-card whitelist" id="whitelistCard">
            <h3>ğŸ“ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</h3>
            <div class="metric">
                <span>í™œì„± í† í° ìˆ˜</span>
                <span class="metric-value" id="whitelistTokens">-</span>
            </div>
            <div class="metric">
                <span>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (KB)</span>
                <span class="metric-value" id="whitelistMemory">-</span>
            </div>
            <div class="metric">
                <span>ê²€ì¦ ì‹œê°„ (ms)</span>
                <span class="metric-value" id="whitelistTime">-</span>
            </div>
        </div>

        <div class="result-card blacklist" id="blacklistCard">
            <h3>ğŸš« ë¸”ë™ë¦¬ìŠ¤íŠ¸</h3>
            <div class="metric">
                <span>ë¬´íš¨í™”ëœ í† í° ìˆ˜</span>
                <span class="metric-value" id="blacklistTokens">-</span>
            </div>
            <div class="metric">
                <span>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (KB)</span>
                <span class="metric-value" id="blacklistMemory">-</span>
            </div>
            <div class="metric">
                <span>ê²€ì¦ ì‹œê°„ (ms)</span>
                <span class="metric-value" id="blacklistTime">-</span>
            </div>
        </div>
    </div>

    <div class="chart" id="chartContainer" style="display: none;">
        <h3>ğŸ“ˆ ì‹œê°„ë³„ í† í° ìˆ˜ ë³€í™”</h3>
        <canvas id="tokenChart"></canvas>
    </div>
</div>

<script>
    // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
    const updateSliderValue = (id, displayId) => {
        document.getElementById(id).addEventListener('input', function() {
            document.getElementById(displayId).textContent = Math.round(this.value * 100) + '%';
        });
    };

    updateSliderValue('loginRate', 'loginRateValue');
    updateSliderValue('logoutRate', 'logoutRateValue');

    function updateProgress(percent) {
        document.getElementById('progressBar').style.width = percent + '%';
    }

    function drawChart(data) {
        const canvas = document.getElementById('tokenChart');
        if (!data.whitelist || !data.blacklist || !data.timestamps) {
            console.error("âŒ Canvas element not found!");
            return;
        }
        const ctx = canvas.getContext('2d');

        // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
        canvas.width = canvas.offsetWidth || 600;
        canvas.height = 300;

        const width = canvas.width;
        const height = canvas.height;
        const padding = 60;

        // ë°°ê²½: í•˜ì–€ìƒ‰ + ê·¸ë¦¼ì
        ctx.fillStyle = '#fff';
        ctx.shadowColor = 'rgba(0,0,0,0.2)';
        ctx.shadowBlur = 15;
        ctx.fillRect(0, 0, width, height);

        // ê·¸ë¦¼ì í•´ì œ (ì„ ê³¼ ê¸€ìì—ëŠ” ì ìš©í•˜ì§€ ì•Šê¸° ìœ„í•´)
        ctx.shadowColor = 'transparent';

        const maxTokens = Math.max(...data.whitelist, ...data.blacklist);
        const xStep = (width - 2 * padding) / (data.timestamps.length - 1);
        const yScale = (height - 2 * padding) / maxTokens;

        // ê²©ì
        ctx.strokeStyle = '#bbb'; // íšŒìƒ‰
        ctx.lineWidth = 1;
        for (let i = 0; i <= 10; i++) {
            const y = padding + (height - 2 * padding) * i / 10;
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(width - padding, y);
            ctx.stroke();
        }

        // í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì„ 
        ctx.strokeStyle = '#4ecdc4';
        ctx.lineWidth = 3;
        ctx.beginPath();
        data.whitelist.forEach((value, index) => {
            const x = padding + index * xStep;
            const y = height - padding - value * yScale;
            if (index === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì„ 
        ctx.strokeStyle = '#ff6b6b';
        ctx.beginPath();
        data.blacklist.forEach((value, index) => {
            const x = padding + index * xStep;
            const y = height - padding - value * yScale;
            if (index === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // ë²”ë¡€
        // í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
        ctx.fillStyle = '#4ecdc4';
        ctx.fillRect(width - 200, 20, 20, 10);
        ctx.fillStyle = '#000'; // ê²€ì •ìƒ‰ ê¸€ì”¨
        ctx.font = 'bold 14px Arial';
        ctx.fillText('í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸', width - 170, 30);

        // ë¸”ë™ë¦¬ìŠ¤íŠ¸
        ctx.fillStyle = '#ff6b6b';
        ctx.fillRect(width - 200, 40, 20, 10);
        ctx.fillStyle = '#000'; // ê²€ì •ìƒ‰ ê¸€ì”¨
        ctx.fillText('ë¸”ë™ë¦¬ìŠ¤íŠ¸', width - 170, 50);
    }

    async function runSimulation() {
        const progressContainer = document.getElementById('progressContainer');
        const results = document.getElementById('results');
        const chartContainer = document.getElementById('chartContainer');

        progressContainer.style.display = 'block';
        results.style.display = 'none';
        chartContainer.style.display = 'none';

        const requestBody = {
            userCount: parseInt(document.getElementById('userCount').value),
            tokenLifetime: parseInt(document.getElementById('tokenLifetime').value),
            sessionsPerUser: parseFloat(document.getElementById('sessionsPerUser').value),
            loginRate: parseFloat(document.getElementById('loginRate').value),
            logoutRate: parseFloat(document.getElementById('logoutRate').value),
        };

        // ë‹¨ìˆœ ì§„í–‰ë¥  ì• ë‹ˆë©”ì´ì…˜
        for (let progress = 0; progress <= 50; progress += 10) {
            updateProgress(progress);
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        try {
            const response = await fetch('/api/simulation', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();
            updateProgress(100);

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('whitelistTokens').textContent = data.whitelistCounts.at(-1).toLocaleString();
            document.getElementById('blacklistTokens').textContent = data.blacklistCounts.at(-1).toLocaleString();

            document.getElementById('whitelistMemory').textContent = data.metrics.whitelistMemoryKB.toLocaleString();
            document.getElementById('whitelistTime').textContent = data.metrics.whitelistTime.toFixed(2);

            document.getElementById('blacklistMemory').textContent = data.metrics.blacklistMemoryKB.toLocaleString();
            document.getElementById('blacklistTime').textContent = data.metrics.blacklistTime.toFixed(2);

            drawChart({
                whitelist: data.whitelistCounts,
                blacklist: data.blacklistCounts,
                timestamps: data.timestamps
            });

            progressContainer.style.display = 'none';
            results.style.display = 'grid';
            chartContainer.style.display = 'block';
        } catch (err) {
            console.error('ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨', err);
            alert('ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            progressContainer.style.display = 'none';
        }
    }

    // ì´ˆê¸° ìŠ¬ë¼ì´ë” ê°’
    document.getElementById('loginRateValue').textContent = '10%';
    document.getElementById('logoutRateValue').textContent = '5%';
</script>
</body>
</html>
